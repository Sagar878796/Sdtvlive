<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Channel List Player</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#111;
  color:white;
}

#player{
  width:100%;
  height:220px;
  background:black;
}

video{
  width:100%;
  height:100%;
}

#channels{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
  padding:10px;
}

.channel{
  background:#222;
  padding:8px;
  border-radius:6px;
  text-align:center;
  cursor:pointer;
}

.channel img{
  width:60px;
  height:60px;
}

.channel:hover{
  background:#333;
}
</style>

</head>
<body>

<div id="player">
  <video id="video" controls autoplay playsinline></video>
</div>

<div id="channels"></div>

<script>

const PLAYLIST_URL = "https://node-proxy-5d7s.onrender.com/playlist";

const video = document.getElementById("video");
const channelsDiv = document.getElementById("channels");

let hls;

function playStream(url){

  if(hls){
    hls.destroy();
  }

  if(Hls.isSupported()){

    hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);

  }else{
    video.src = url;
  }

}

function addChannel(name, logo, url){

  const div = document.createElement("div");
  div.className = "channel";

  div.innerHTML = `
    <img src="${logo}" onerror="this.src='https://via.placeholder.com/60'">
    <div>${name}</div>
  `;

  div.onclick = () => playStream(url);

  channelsDiv.appendChild(div);
}

async function loadPlaylist(){

  const res = await fetch(PLAYLIST_URL);
  const text = await res.text();

  const lines = text.split("\n");

  let name = "";
  let logo = "";

  for(let line of lines){

    if(line.startsWith("#EXTINF")){

      name = line.split(",").pop();

      const match = line.match(/tvg-logo="([^"]+)"/);
      logo = match ? match[1] : "";

    }

    if(line.startsWith("http")){

      addChannel(name, logo, line);

    }

  }

}

loadPlaylist();

</script>

</body>
</html>
