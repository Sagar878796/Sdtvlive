<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRT Stream Player</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.compiled.js"></script>

<style>

body{
margin:0;
background:#000;
color:#fff;
font-family:Arial;
}

#video-container{
width:100%;
height:40vh;
background:#000;
}

video{
width:100%;
height:100%;
}

#channels{
height:60vh;
overflow-y:auto;
background:#111;
}

.channel{
padding:15px;
border-bottom:1px solid #333;
cursor:pointer;
}

.channel:hover{
background:#222;
}

</style>

</head>

<body>

<div id="video-container">
<video id="video" controls autoplay></video>
</div>

<div id="channels">
Loading channels...
</div>

<script>

const PLAYLIST_URL =
"http://127.0.0.1:8080/playlist";

const PROXY =
"http://127.0.0.1:8080/proxy?url=";

let player;

async function initPlayer(){

const video =
document.getElementById("video");

player =
new shaka.Player(video);

}

async function loadPlaylist(){

try{

const response =
await fetch(PLAYLIST_URL);

const text =
await response.text();

parsePlaylist(text);

}
catch(e){

document.getElementById("channels")
.innerHTML="Playlist load failed";

}

}

function parsePlaylist(text){

const lines =
text.split("\n");

const channelsDiv =
document.getElementById("channels");

channelsDiv.innerHTML="";

let name="";
let logo="";

for(let i=0;i<lines.length;i++){

const line =
lines[i].trim();

if(line.startsWith("#EXTINF")){

name =
line.split(",")[1];

}

else if(line.startsWith("http")){

const url=line;

const div=
document.createElement("div");

div.className="channel";

div.innerHTML=name;

div.onclick=()=>playChannel(url);

channelsDiv.appendChild(div);

}

}

}

async function playChannel(url){

try{

await player.load(
PROXY + encodeURIComponent(url)
);

}
catch(e){

alert("Play failed");

}

}

initPlayer();
loadPlaylist();

</script>

</body>
</html>
