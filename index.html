<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STV LIVE</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js"></script>

<style>

body{
margin:0;
background:#000;
font-family:Arial;
color:white;
}

.shaka-video-container{
width:100%;
height:220px;
background:black;
}

video{
width:100%;
height:100%;
}

#grid{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:8px;
padding:10px;
}

.item{
background:#111;
padding:10px;
border-radius:6px;
text-align:center;
cursor:pointer;
}

.item img{
width:60px;
height:60px;
}

</style>

</head>

<body>

<div class="shaka-video-container" data-shaka-player>
<video autoplay playsinline controls></video>
</div>

<div id="grid"></div>

<script>

const PROXY="https://stvlive-proxy.onrender.com/proxy?url=";

const PLAYLIST="https://raw.githubusercontent.com/Sagar878796/Stvlive/main/playlist.m3u";

let player;
let video;

init();

async function init(){

video=document.querySelector("video");

player=new shaka.Player(video);

const container=document.querySelector('.shaka-video-container');

new shaka.ui.Overlay(player,container,video);

player.getNetworkingEngine().registerRequestFilter((type, request)=>{

request.headers['User-Agent']=
'Mozilla/5.0 (Linux; Android 10) AppleWebKit/537.36 Chrome/140 Mobile Safari/537.36';

request.headers['Referer']='https://www.hotstar.com/';
request.headers['Origin']='https://www.hotstar.com';

});

loadPlaylist();

}

async function loadPlaylist(){

const res=await fetch(PLAYLIST);

const text=await res.text();

const lines=text.split("\n");

let name="";
let logo="";

for(let line of lines){

if(line.startsWith("#EXTINF")){

name=line.split(",").pop();

const m=line.match(/tvg-logo="([^"]+)"/);

logo=m?m[1]:"";

}

else if(line.startsWith("http")){

createChannel(name,logo,line);

}

}

}

function createChannel(name,logo,url){

const div=document.createElement("div");

div.className="item";

div.innerHTML=`

<img src="${logo}">

<div>${name}</div>

`;

div.onclick=()=>play(url);

grid.appendChild(div);

}

async function play(url){

try{

await player.load(PROXY+encodeURIComponent(url));

}

catch(e){

alert("Play error");

console.log(e);

}

}

</script>

</body>

</html>
